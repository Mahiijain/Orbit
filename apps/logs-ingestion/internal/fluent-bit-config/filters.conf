# filters.conf
# Filter configurations for log processing

# Filter to add hostname and standardize fields
[FILTER]
    name         record_modifier
    match        logs.*
    record       hostname ${HOSTNAME}
    record       collector fluent-bit
    record       ingestion_time ${FLUENT_BIT_TIMESTAMP}

# Filter to parse and enrich timestamp
[FILTER]
    name         modify
    match        logs.*
    rename       timestamp original_timestamp
    add          processed_at ${FLUENT_BIT_TIMESTAMP}

# Filter to add log type from tag
[FILTER]
    name         lua
    match        logs.*
    script       tag_processor.lua
    call         add_log_category

# Filter for error alerting (optional)
[FILTER]
    name         grep
    match        logs.*
    regex        level (ERROR|CRITICAL)
    alias        error_filter

# Filter to extract additional fields from system logs
[FILTER]
    name         parser
    match        logs.system
    key_name     message
    parser       service_extractor
    reserve_data true
    preserve_key true

# Filter to extract additional fields from network logs
[FILTER]
    name         parser
    match        logs.network
    key_name     message
    parser       hostname_extractor
    reserve_data true
    preserve_key true

# Filter to extract job information from slurm logs
[FILTER]
    name         parser
    match        logs.slurm
    key_name     message
    parser       job_id_extractor
    reserve_data true
    preserve_key true

# Filter to extract error codes from error messages
[FILTER]
    name         parser
    match        logs.*
    key_name     message
    parser       error_code_extractor
    reserve_data true
    preserve_key true